<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChordManager</title>
    
    <link rel="stylesheet" href="/styles/variables.css">
    <link rel="stylesheet" href="/styles/base.css">
    <link rel="stylesheet" href="/styles/layout.css">
    <link rel="stylesheet" href="/styles/sidebar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<div class="main-container">
    <aside class="sidebar">
        <div class="logo">
            <h2>Chords&<span>Tabs</span></h2>
        </div>

        <div class="auth-section">
            <?php if(isset($_SESSION['user_id'])): ?>
                
                <div class="user-profile">
                    <div class="avatar-circle">
                        <?= strtoupper(substr($_SESSION['nickname'] ?? 'U', 0, 1)) ?>
                    </div>
                    <h3><?= $_SESSION['nickname'] ?? 'User' ?></h3>
                </div>

                <nav class="main-nav">
                    <ul>
                        <li>
                            <a href="/library" class="<?= (isset($page) && $page == 'library') ? 'active' : '' ?>">
                                <i class="fa-solid fa-book-open"></i> <span class="nav-text">Library</span>
                            </a>
                        </li>
                        <li>
                            <a href="/songs" class="<?= (isset($page) && ($page == 'songs' || $page == 'add_song')) ? 'active' : '' ?>">
                                <i class="fa-solid fa-music"></i> <span class="nav-text">Songs</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <div class="logout-section">
                    <a href="/logout" class="btn-logout">
                        <i class="fa-solid fa-right-from-bracket"></i> <span>Logout</span>
                    </a>
                </div>

            <?php else: ?>

                <div class="login-mini-form desktop-only">
                    <h3>Welcome Back</h3>
                    <p>Sign in to access your tabs.</p>
                    
                    <form action="login" method="POST">
                        <input type="hidden" name="csrf" value="<?= $csrf ?? '' ?>">
                        
                        <input type="email" name="email" placeholder="Email" required>
                        <input type="password" name="password" placeholder="Password" required>
                        <button type="submit" class="btn-login">Log In</button>
                    </form>
                    
                    <div class="register-link">
                        <span>New here?</span> <a href="/register">Create an account</a>
                    </div>
                </div>

                <nav class="mobile-guest-nav">
                    <ul>
                        <li>
                            <a href="/login">
                                <i class="fa-solid fa-right-to-bracket"></i>
                                <span>Login</span>
                            </a>
                        </li>
                        <li>
                            <a href="/register">
                                <i class="fa-solid fa-user-plus"></i>
                                <span>Join</span>
                            </a>
                        </li>
                    </ul>
                </nav>

            <?php endif; ?>
        </div>
    </aside>

    <main class="content-area">
        <?php if(isset($messages)): ?>
            <div class="flash-messages">
                <?php foreach($messages as $msg): ?>
                    <div class="alert"><?= $msg ?></div>
                <?php endforeach; ?>
            </div>
        <?php endif; ?>

        <?= $output ?? '' ?>
    </main>
</div>

</body>
</html>